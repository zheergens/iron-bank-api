{% extends "admin/base_admin.html" %}

{% block title %}用户管理 - 登录系统{% endblock %}

{% block admin_content %}
<div class="admin-card">
    <div class="admin-card-header">
        <h2 class="admin-card-title">用户管理</h2>
        <div class="admin-actions">
            <a href="{{ url_for('admin.new_user') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                添加用户
            </a>
        </div>
    </div>
    
    <div class="table-toolbar">
        <div class="table-search">
            <input type="text" class="search-input" placeholder="搜索用户...">
            <button class="btn btn-secondary">
                <i class="fas fa-search"></i>
                搜索
            </button>
        </div>
        <div class="table-actions">
            <button class="btn btn-secondary">
                <i class="fas fa-download"></i>
                导出
            </button>
        </div>
    </div>

    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>用户名</th>
                    <th>邮箱</th>
                    <th>手机号</th>
                    <th>角色</th>
                    <th>状态</th>
                    <th>注册时间</th>
                    <th>最后登录</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone or '未设置' }}</td>
                    <td>
                        <span class="badge {% if user.role == 'admin' %}badge-primary{% else %}badge-default{% endif %}">
                            {{ user.role }}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge {% if user.is_active %}status-active{% else %}status-inactive{% endif %}">
                            {{ '活跃' if user.is_active else '未激活' }}
                        </span>
                    </td>
                    <td>{{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else '从未登录' }}</td>
                    <td>
                        <div class="table-actions">
                            <a href="{{ url_for('admin.edit_user', user_id=user.id) }}" class="btn btn-sm btn-secondary" title="编辑">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser('{{ user.id }}')" title="删除">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="pagination">
        <button class="page-item" disabled>
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="page-item active">1</button>
        <button class="page-item">2</button>
        <button class="page-item">3</button>
        <button class="page-item">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
</div>

<!-- 删除确认对话框 -->
<div class="modal" id="deleteModal" style="display: none;">
    <div class="modal-content">
        <h3>确认删除</h3>
        <p>您确定要删除这个用户吗？此操作不可撤销。</p>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">取消</button>
            <button class="btn btn-danger" onclick="confirmDelete()">删除</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
{{ super() }}
.page-container {
    padding: 24px;
}

.content-card {
    background: #fff;
    border-radius: 8px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.header h1 {
    margin: 0;
    font-size: 24px;
    color: #1f2937;
}

.table-container {
    overflow-x: auto;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th,
.data-table td {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
}

.data-table th {
    background: #f9fafb;
    font-weight: 500;
    color: #374151;
}

.data-table tr:hover {
    background: #f9fafb;
}

.badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 9999px;
    font-size: 12px;
    font-weight: 500;
}

.badge-primary {
    background: #e0f2fe;
    color: #0369a1;
}

.badge-default {
    background: #f3f4f6;
    color: #4b5563;
}

.badge-success {
    background: #dcfce7;
    color: #15803d;
}

.badge-danger {
    background: #fee2e2;
    color: #b91c1c;
}

.action-buttons {
    display: flex;
    gap: 8px;
}

.btn-small {
    height: 32px;
    padding: 0 12px;
    font-size: 12px;
}

.btn-danger {
    background: #dc2626;
    color: white;
}

.btn-danger:hover {
    background: #b91c1c;
}
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
let userIdToDelete = null;

function deleteUser(userId) {
    userIdToDelete = userId;
    document.getElementById('deleteModal').style.display = 'flex';
}

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
    userIdToDelete = null;
}

function confirmDelete() {
    if (userIdToDelete) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/users/${userIdToDelete}/delete`;
        document.body.appendChild(form);
        form.submit();
    }
}

// 点击模态框外部关闭
window.onclick = function(event) {
    const modal = document.getElementById('deleteModal');
    if (event.target == modal) {
        closeDeleteModal();
    }
}
</script>
{% endblock %} 