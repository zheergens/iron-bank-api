{% extends "layouts/admin.html" %}

{% block title %}系统信息 - 管理系统{% endblock %}

{% block admin_content %}
<div class="content-card">
    <div class="header">
        <h1>系统信息</h1>
    </div>
    
    <div class="info-grid">
        <div class="info-item">
            <div class="info-label">系统版本</div>
            <div class="info-value">{{ system_info.version }}</div>
        </div>
        <div class="info-item">
            <div class="info-label">运行时间</div>
            <div class="info-value">{{ system_info.uptime }}</div>
        </div>
        <div class="info-item">
            <div class="info-label">CPU使用率</div>
            <div class="info-value">
                <div class="progress-bar">
                    <div class="progress" style="width: {{ system_info.cpu_usage }}%"></div>
                </div>
                <span class="percentage">{{ system_info.cpu_usage }}%</span>
            </div>
        </div>
        <div class="info-item">
            <div class="info-label">内存使用率</div>
            <div class="info-value">
                <div class="progress-bar">
                    <div class="progress" style="width: {{ system_info.memory_usage }}%"></div>
                </div>
                <span class="percentage">{{ system_info.memory_usage }}%</span>
            </div>
        </div>
    </div>
</div>

<div class="content-card" style="margin-top: 24px;">
    <div class="header">
        <h1>已注册的应用</h1>
        <button class="btn btn-primary">
            <i class="fas fa-plus"></i>
            注册新应用
        </button>
    </div>
    
    <div class="app-grid">
        {% for app in registered_apps %}
        <div class="app-card">
            <div class="app-header">
                <div class="app-icon">
                    <i class="fas fa-cube"></i>
                </div>
                <div class="app-status {% if app.is_active %}active{% endif %}"></div>
            </div>
            <div class="app-content">
                <h3 class="app-name">{{ app.name }}</h3>
                <div class="app-info">
                    <div class="info-row">
                        <span class="label">应用ID：</span>
                        <span class="value">{{ app.id }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Client ID：</span>
                        <span class="value">{{ app.client_id }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">回调地址：</span>
                        <span class="value">{{ app.redirect_uri }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">创建时间：</span>
                        <span class="value">{{ app.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                </div>
            </div>
            <div class="app-footer">
                <button class="btn btn-sm btn-secondary" onclick="showAppDetails('{{ app.id }}')" title="查看详情">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteApp('{{ app.id }}', '{{ app.name }}')" title="删除">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- 应用详情对话框 -->
<div class="modal" id="appDetailsModal" style="display: none;">
    <div class="modal-content">
        <h3>应用详情</h3>
        <div class="app-details">
            <div class="details-row">
                <span class="label">Client Secret：</span>
                <span class="value" id="appClientSecret"></span>
            </div>
            <div class="details-row">
                <span class="label">授权范围：</span>
                <span class="value" id="appScopes"></span>
            </div>
            <div class="details-row">
                <span class="label">最后更新：</span>
                <span class="value" id="appLastUpdated"></span>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closeAppDetailsModal()">关闭</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
function showAppDetails(appId) {
    // 这里应该发送请求获取应用详细信息
    document.getElementById('appDetailsModal').style.display = 'flex';
}

function closeAppDetailsModal() {
    document.getElementById('appDetailsModal').style.display = 'none';
}

function deleteApp(appId, appName) {
    if (confirm(`确定要删除应用"${appName}"吗？此操作不可撤销。`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/apps/${appId}/delete`;
        document.body.appendChild(form);
        form.submit();
    }
}

// 点击模态框外部关闭
window.onclick = function(event) {
    const modal = document.getElementById('appDetailsModal');
    if (event.target == modal) {
        closeAppDetailsModal();
    }
}
</script>
{% endblock %} 