{% extends "admin/base_admin.html" %}

{% block title %}个人中心 - 登录系统{% endblock %}

{% block head_css %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css', v='1.0.0') }}">
{% endblock %}

{% block admin_content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar">
            <span class="avatar-text">{{ current_user.username[0].upper() }}</span>
        </div>
        <div class="profile-info">
            <h1 class="profile-name">{{ current_user.username }}</h1>
            <p class="profile-role">{{ '管理员' if current_user.role == 'admin' else '普通用户' }}</p>
        </div>
    </div>

    <div class="profile-card">
        <div class="card-header">
            <h2>基本信息</h2>
            <button class="btn btn-primary" onclick="showEditDialog()">
                <i class="fas fa-edit"></i>
                编辑资料
            </button>
        </div>
        
        <div class="profile-form">
            <div class="form-group">
                <label class="form-label">用户名</label>
                <input type="text" class="form-input" value="{{ current_user.username }}" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">邮箱地址</label>
                <input type="email" class="form-input" value="{{ current_user.email }}" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">手机号码</label>
                <input type="tel" class="form-input" value="{{ current_user.phone or '' }}" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">注册时间</label>
                <input type="text" class="form-input" value="{{ current_user.created_at.strftime('%Y-%m-%d %H:%M') }}" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">最后登录</label>
                <input type="text" class="form-input" value="{{ current_user.last_login.strftime('%Y-%m-%d %H:%M') if current_user.last_login else '从未登录' }}" readonly>
            </div>
        </div>
    </div>
</div>

<!-- 编辑资料对话框 -->
<div id="edit-dialog" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditDialog()">&times;</span>
        <h2>编辑个人资料</h2>
        <form id="editForm" method="POST" action="{{ url_for('user.profile_update') }}" class="profile-form">
            <div class="form-group">
                <label class="form-label">用户名</label>
                <input type="text" class="form-input" value="{{ current_user.username }}" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">邮箱地址</label>
                <input type="email" class="form-input" value="{{ current_user.email }}" readonly>
            </div>
            
            <div class="form-group">
                <label class="form-label">手机号码</label>
                <input type="tel" class="form-input" name="phone" value="{{ current_user.phone or '' }}" placeholder="请输入手机号码">
            </div>

            <div class="form-group">
                <label class="form-label">当前密码</label>
                <input type="password" class="form-input" name="current_password" placeholder="请输入当前密码">
            </div>
            
            <div class="form-group">
                <label class="form-label">新密码 (如需修改)</label>
                <input type="password" class="form-input" name="new_password" placeholder="请输入新密码">
            </div>
            
            <div class="form-group">
                <label class="form-label">确认新密码</label>
                <input type="password" class="form-input" name="confirm_password" placeholder="请再次输入新密码">
            </div>
            
            <div class="button-group">
                <button type="button" class="btn btn-secondary" onclick="closeEditDialog()">取消</button>
                <button type="submit" class="btn btn-primary">保存更改</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
function showEditDialog() {
    document.getElementById('edit-dialog').style.display = 'flex';
}

function closeEditDialog() {
    document.getElementById('edit-dialog').style.display = 'none';
}

// 关闭模态框当点击外部区域
window.onclick = function(event) {
    const editDialog = document.getElementById('edit-dialog');
    if (event.target == editDialog) {
        editDialog.style.display = 'none';
    }
}
</script>
{% endblock %}